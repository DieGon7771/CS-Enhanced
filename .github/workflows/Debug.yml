name: Debug APK Build (No Secrets)

on:
  workflow_dispatch:  # Solo attivazione manuale
    inputs:
      clean_build:
        description: 'Clean build (takes longer)'
        required: true
        default: 'false'
        type: boolean

jobs:
  build-debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup JDK 17
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
    
    - name: Make gradlew executable
      run: chmod +x gradlew
    
    - name: Clean build (optional)
      if: github.event.inputs.clean_build == 'true'
      run: ./gradlew clean
    
    - name: Build Debug APK
      run: ./gradlew assembleDebug --no-daemon
    
    - name: Upload APK artifact
      uses: actions/upload-artifact@v4
      with:
        name: cloudstream-debug-apk
        path: |
          app/build/outputs/apk/debug/*.apk
          app/build/outputs/mapping/debug/*/mapping.txt
        retention-days: 7
        if-no-files-found: error
    
    - name: Show APK info
      run: |
        echo "âœ… Build completato!"
        echo "APK generati:"
        find app/build/outputs/apk/debug/ -name "*.apk" -type f | while read apk; do
          echo "  - $(basename "$apk") ($(du -h "$apk" | cut -f1))"
        done
